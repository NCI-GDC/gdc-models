sudo: true
language: python
env:
  - ES_VERSION="7.7.1"
python:
  - "3.7"

before_install:
  - sudo rm -rf /var/lib/elasticsearch

before_script:
  - curl -O https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-${ES_VERSION}-amd64.deb
  - sudo dpkg -i --force-confnew elasticsearch-${ES_VERSION}-amd64.deb
  - sudo chown elasticsearch /etc/default/elasticsearch
  # Our ES mappings require the mapper-size plugin to be installed
  - sudo /usr/share/elasticsearch/bin/elasticsearch-plugin install mapper-size
  - sudo service elasticsearch restart

install:
  - pip install tox-travis

env:
  - ES_HOST=localhost

script:
  - tox

after_script:
  - tox -e coverage
  - bash <(curl -s -L https://detect.synopsys.com/detect.sh) --blackduck.url="https://cdis.blackducksoftware.com" --blackduck.api.token=$(echo $BLACKDUCK_TOKEN) --blackduck.trust.cert=true --detect.policy.check=true  --snippet-matching=true --full-snippet-scan=true
